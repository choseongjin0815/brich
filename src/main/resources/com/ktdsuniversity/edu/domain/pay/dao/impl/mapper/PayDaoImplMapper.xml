<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ktdsuniversity.edu.domain.pay.dao.impl.PayDaoImpl">
    
  <select id="selectPayInfoList"
          resultType="com.ktdsuniversity.edu.global.common.CommonCodeVO">
		  SELECT CD_ID
		       , CD_NM
		       , PRNT_CD_ID
		       , USE_YN
		       , SRT
		       , KEY1
		       , VALUE1
		       , KEY2
		       , VALUE2
		       , KEY3
		       , VALUE3
		   FROM CM_CD
		  START WITH PRNT_CD_ID IN ('A000')
		CONNECT BY PRIOR CD_ID = PRNT_CD_ID
 </select>
 <select id="selectPayInfo"
         parameterType="string"
         resultType="com.ktdsuniversity.edu.global.common.CommonCodeVO">
		  SELECT CD_ID
		       , CD_NM
		       , PRNT_CD_ID
		       , USE_YN
		       , SRT
		       , KEY1
		       , VALUE1
		       , KEY2
		       , VALUE2
		       , KEY3
		       , VALUE3
		   FROM CM_CD
		  WHERE CD_ID = #{_parameter}
 </select>
 <insert id="insertBeforeSubscribePaymentInfoSave"
         parameterType = "com.ktdsuniversity.edu.domain.pay.vo.request.RequestPaymentVO">
	    <selectKey keyProperty="PKkey" order="BEFORE" resultType="string">
	    SELECT 'SBSCRPTN_PYMNT-' || TO_CHAR(SYSDATE, 'YYYYMMDD-') || LPAD(SEQ_SBSCRPTN_PYMNT_PK.NEXTVAL, 6, 0)
	           FROM DUAL
	    </selectKey>
		INSERT INTO SBSCRPTN_PYMNT
		(SBSCRPTN_PYMNT_ID
		, USR_ID
		, PYMNT_CD
		, SBSCRPTN_CD
		, AMNT
		, CRT_DT
		, CRTR
		, UPDT_DT
		, MTTR
		, DLT_YN
		, ORDER_ID
		, PAYMENT_KEY)
		VALUES
		( #{PKkey}
		, #{clientId}
		, '9002'
		, NULL
		, #{clientPrice}
		, SYSDATE
		, 'SYSTEM'
		, SYSDATE
		, 'SYSTEM'
		, 'N' 
		, #{clientOrderId}
		, NULL
		)        
 </insert>		
 <insert id="insertBeforeCampaignPaymentInfoSave"
         parameterType = "com.ktdsuniversity.edu.domain.pay.vo.request.RequestPaymentVO">
        <selectKey keyProperty="PKkey" order="BEFORE" resultType="string">
        SELECT 'CMPN_PYMNT-' || TO_CHAR(SYSDATE, 'YYYYMMDD-') || LPAD(SEQ_SBSCRPTN_PYMNT_PK.NEXTVAL, 6, 0)
               FROM DUAL
        </selectKey>         
		 INSERT INTO CMPN_PYMNT
		(CMPN_PYMNT_ID
		, CMPN_ID
		, PYMNT_CD
		, AMNT
		, CRT_DT
		, CRTR
		, UPDT_DT
		, MTTR
		, DLT_YN
		, ORDER_ID
		, PAYMENT_KEY)
		VALUES( #{PKkey}
		, #{clientId}
		, 9002
		, #{clientPrice}
		, SYSDATE
		, 'SYSTEM'
		, SYSDATE
		, ''SYSTEM'
		, 'N' 
		, #{clientOrderId}
		, NULL
		)
 </insert>
 
 <select id="selectBeforeSaveInfo"
         parameterType="string"
         resultType="com.ktdsuniversity.edu.domain.pay.vo.response.ResponsePaymentVO">
		SELECT ORDER_ID AS ORDER_ID
		     , AMNT AS AMOUNT
		  FROM CMPN_PYMNT
		 WHERE CMPN_PYMNT_ID = #{_parameter}
		 UNION ALL
		SELECT ORDER_ID AS ORDER_ID 
		     , AMNT AS AMOUNT
		  FROM SBSCRPTN_PYMNT
		 WHERE SBSCRPTN_PYMNT_ID=  #{_parameter}
 </select>
 <update id="updatePaymentSuccessSubscribe"
         parameterType = "com.ktdsuniversity.edu.domain.pay.vo.request.RequestPaymentVO">
		UPDATE SBSCRPTN_PYMNT
		   SET USR_ID       = #{clientUsrId}
		     , PYMNT_CD     = '9001'
		     , SBSCRPTN_CD  = #{sbscrptnCd}
		     , PAYMENT_KEY  = #{paymentKey}
		 WHERE SBSCRPTN_PYMNT_ID = #{PKkey}       
 </update>
 
 <select id="selectSbscrptnCd"
         resultType="string"
         parameterType = "string">
         SELECT CD_ID 
           FROM CM_CD
          WHERE VALUE1 = #{_parameter}
 </select>
</mapper>










